{% load filters %}
{% include 'super_admin/partials/main.html' %}
{% include 'super_admin/partials/title-meta.html' with title=data|get:"changePassword" %}
<head>
    {% load static %}
    {% include 'super_admin/partials/head-css.html' %}
    <!-- Custom Nav Styles -->
    <link href="{% static 'super_admin/assets/css/custom-nav.css' %}" rel="stylesheet" type="text/css" />
</head>
{% include 'super_admin/partials/body.html' %}
<div class="group-data-[sidebar-size=sm]:min-h-[1500px] group-data-[sidebar-size=sm]:relative">

      {% include 'super_admin/partials/sidebar.html' %}
    {% include 'super_admin/partials/topbar.html' %}


    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="relative group-data-[sidebar-size=sm]:min-h-[1500px]">

        <div class="container-top-fluid">
            <div class="container-fluid">

                
                {% include 'super_admin/partials/page-title.html' with title=data|get:"changePassword" pagetitle=data|get:"changePassword" %}

                <div class="grid grid-cols-12 lg:gap-x-6">
                    
                    <div class="col-span-12 lg:col-span-6">
                        <div class="card dark:bg-zink-700">
                            <div class="card-body">
                                <h6 class="text-15 dark:text-white font-semibold mb-4"> {{data|get:"Update Your Password"}} </h6>
                                <div id="info_selector"></div>
                                <form method="POST" class="{% url 'super_admin:changePassword' %}" id="change_password_form">  
                                	{% csrf_token %}
	                                <div class="gap-4 grid grid-cols-12">
	                                    <div class="col-span-12 sm:col-span-3">
	                                        <label for="example-text-input" class="block font-medium text-gray-700 text-13 mt-2 dark:text-zink-200 dark:bg-transparent dark:border-zink-50 dark:placeholder:text-zink-200">{{data|get:"Username"}}</label>
	                                    </div>
	                                    <div class="col-span-12 sm:col-span-9">
	                                        <input class="w-full border py-2 px-3 text-13 placeholder:text-gray-600 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:text-zink-200 dark:bg-transparent dark:border-zink-50 dark:placeholder:text-zink-200" id="username" value="{{ request.user.username }}" disabled>
	                                    </div>
	                                    <div class="col-span-12 sm:col-span-3">
	                                        <label for="example-text-input" class="block font-medium text-gray-700 text-13 mt-3 dark:text-zink-200  ">{{super_admin_data|get:"Employee Email"}}</label>
	                                    </div>
	                                    <div class="col-span-12 sm:col-span-9">
	                                        <input class="w-full border py-2 px-3 text-13 placeholder:text-gray-600 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:text-zink-200 dark:bg-transparent dark:border-zink-50 dark:placeholder:text-zink-200" type="email" value="{{ request.user.employee_email }}" disabled>
	                                    </div>
	                                    <div class="col-span-12 sm:col-span-3">
	                                        <label for="example-text-input" class="block font-medium text-gray-700 text-13 mt-3 dark:text-zink-200">{{data|get:"New Password"}}</label>
	                                    </div>
	                                    <div class="col-span-12 sm:col-span-9">
	                                        <input class="w-full border py-2 px-3 text-13 placeholder:text-gray-600 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:text-zink-200 dark:bg-transparent dark:border-zink-50 dark:placeholder:text-zink-200" name="new_password" id="new_password" type="text" required>
	                                    </div>

	                                    <div class="col-span-12 sm:col-span-3">
	                                        <label for="example-text-input" class="block font-medium text-gray-700 text-13 mt-3 dark:text-zink-200">
	                                        	{{data|get:"Confirm New Password"}}
	                                        </label>
	                                    </div>
	                                    <div class="col-span-12 sm:col-span-9">
	                                        <input class="w-full border py-2 px-3 text-13 placeholder:text-gray-600 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:text-zink-200 dark:bg-transparent dark:border-zink-50 dark:placeholder:text-zink-200" name="confirm_new_password" id="confirm_new_password" type="text" required>
	                                    
	                                        <button type="button" onclick="generatePassword();" class="mt-2 text-blue-500 transition-all duration-300 ease-linear bg-white border-blue-500 focus:text-white focus:ring focus:ring-blue-500/30 hover:bg-blue-600 hover:border-blue-600 hover:text-white active:bg-blue-600 active:border-blue-600 active:text-white dark:bg-transparent focus:bg-blue-500 focus:border-blue-600 btn" title='{{data|get:"Generate Password"}}'><i class="bx bx-cog"></i></button>
	                                    </div>

	                                    


	                                    <input type="hidden" name="role_id" value="{{ request.user.role_id }}">
	                                    <input type="hidden" name="user_id" value="{{ request.user.id }}">

	                                     <div class="col-span-12 sm:col-span-3">
	                                        <label for="example-text-input" class="block font-medium text-gray-700 text-13 mt-3 dark:text-zink-200"> {{data|get:"Current Password"}}</label>
	                                    </div>
	                                    <div class="col-span-12 sm:col-span-9">
	                                        <input class="w-full border py-2 px-3 text-13 placeholder:text-gray-600 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:text-zink-200 dark:bg-transparent dark:border-zink-50 dark:placeholder:text-zink-200" name="current_password" id="current_password" type="password" required>
	                                    </div>

	                                    <div class="col-span-12 sm:col-span-3"></div>
	                                    <div class="col-span-12 sm:col-span-9">
	                                        <button type="submit" class="px-7 text-white transition-all duration-300 ease-linear bg-blue-500 border-blue-500 hover:bg-blue-600 hover:border-blue-600 hover:text-white active:bg-blue-600 active:border-blue-600 active:text-white focus:bg-blue-600 focus:border-blue-600 focus:text-white focus:ring focus:ring-blue-500/30 btn"> {{data|get:"changePassword"}}</button>
	                                    </div>

	                                </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- container-fluid -->
        </div>
        <!-- End Page-content -->

              {% include 'super_admin/partials/footer.html' %}
    </div>
</div>
<!-- end main content -->

{% include 'super_admin/partials/customizer.html' %}
{% include 'super_admin/partials/vendor-scripts.html' %}
<!-- App js -->
<script src="{% static 'super_admin/assets/js/app.js' %}"></script>
<script>
    // JavaScript code for password generation
    function generatePassword() {
        // Your password generation logic here
        // For simplicity, let's generate a random 8-character password
        const password = Math.random().toString(36).slice(-14);

        // Update the input field with the generated password
        document.getElementById('new_password').value = password;
         document.getElementById('confirm_new_password').value = password;
    }

    $(document).ready(function(){
    	$("#change_password_form").submit(function(e){
    		e.preventDefault();
    		let form_data = $(this).serialize();
    		let new_password = $("#new_password").val().trim();
    		let confirm_new_password = $("#confirm_new_password").val().trim();
    		if (new_password.length === confirm_new_password.length){
    			if (new_password.length < 10){
    						$("#info_selector").empty().append(`<div class="px-5 py-3 text-red-800 bg-red-100 border border-red-200 rounded-md dark:border-red-500/20 dark:text-red-200 dark:bg-red-500/20 mb-4" role="alert" id="error">The length of password must be equal or greater than 10</div>`);
    			}else if (new_password === confirm_new_password){
	    			$.ajax({
	    				method: 'POST',
	    				url: $(this).attr('class'),
	    				data: form_data,
	    				dataType: 'JSON',
	    				success:function(data){
	    					if (data.success == 1){
	    						$("#change_password_form")[0].reset();
	    						$("#info_selector").empty().append(`<div class="px-5 py-3 text-green-800 bg-green-100 border border-green-200 rounded-md dark:text-green-200 dark:bg-green-500/20 dark:border-green-500/20" role="alert">${data.msg}</div>`);
	    					}else{
	    						$("#info_selector").empty().append(`<div class="px-5 py-3 text-red-800 bg-red-100 border border-red-200 rounded-md dark:border-red-500/20 dark:text-red-200 dark:bg-red-500/20 mb-4" role="alert" id="error">${data.msg}</div>`);
	    					}
	    				},
	    				error:function(data){
	    					console.log(data);
	    				}
	    			});  //end ajax() call
    			}
    		}else{
    			$("#info_selector").empty().append(`<div class="px-5 py-3 text-red-800 bg-red-100 border border-red-200 rounded-md dark:border-red-500/20 dark:text-red-200 dark:bg-red-500/20 mb-4" role="alert" id="error">Both passwords does not match</div>`);
    		}
    	});
    });  //end ready function here
</script>
</body>
</html>