{% load filters %}
{% include 'super_admin/partials/main.html' %}
{% include 'super_admin/partials/title-meta.html' with title=data|get:"add super admin" %}
<head>

    {% load static %}
    {% include 'super_admin/partials/head-css.html' %}
     <link href="/static/super_admin/assets/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />

</head>

{% include 'super_admin/partials/body.html' %}
<div class="group-data-[sidebar-size=sm]:min-h-[1500px] group-data-[sidebar-size=sm]:relative">

     {% include 'super_admin/partials/sidebar.html' %}
    {% include 'super_admin/partials/topbar.html' %}


    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="relative min-h-screen group-data-[sidebar-size=sm]:min-h-[1500px]">

        <div class="group-data-[sidebar-size=lg]:ltr:lg:ml-vertical-menu group-data-[sidebar-size=lg]:rtl:lg:mr-vertical-menu group-data-[sidebar-size=md]:ltr:ml-vertical-menu-md group-data-[sidebar-size=md]:rtl:mr-vertical-menu-md group-data-[sidebar-size=sm]:ltr:lg:ml-vertical-menu-sm group-data-[sidebar-size=sm]:lg:rtl:mr-vertical-menu-sm pt-[calc(theme('spacing.header')_*_1)] pb-[calc(theme('spacing.header')_*_1)] px-6 group-data-[layout=horizontal]:!mx-auto group-data-[layout=horizontal]:max-w-screen-2xl  group-data-[layout=horizontal]:lg:pt-[calc(theme('spacing.header')_*_1.75)] ">
            <div class="container-fluid">

                {% include 'super_admin/partials/page-title.html' with title=request.session|get:"Super Admins"  pagetitle=data|get:"add super admin" %}

                 <a href="{% url 'super_admin:viewSuperAdmin' %}" class="mb-4 text-white transition-all duration-300 ease-linear bg-green-500 border-green-500 hover:bg-green-600 hover:border-green-600 hover:text-white active:bg-green-600 active:border-green-600 active:text-white focus:bg-green-600 focus:border-green-600 focus:text-white focus:ring focus:ring-green-500/30 btn">{{request.session|get:"Super Admins"}}</a>



                <div class="grid grid-cols-1">
                    	
                    <div class="card dark:border-zink-50 dark:bg-zink-700">
                            <div class="card-body">
                                
                                {% if entry_type == 'single' %}
                                <h6 class="font-semibold text-16 mb-5">{{  data|get:"add super admin" }}</h6>
		                                <form method="POST" class ="{% url 'super_admin:addSuperAdmin' %}" id="add_user_form">
		                                	<input type="hidden" name="entry_type" id="entry_type" value="{{ entry_type }}">
		                                	<div id="info_selector"></div>
		                                	

		                                	{% csrf_token %}
			                                <div class="grid grid-cols-12 gap-5">
			                                	<div class="col-span-12 lg:col-span-6">
			                                		<div>

					                                    <div>
					                                        <label for="example-text-input" class="block font-medium text-gray-700 mb-2 text-13 dark:text-zink-200">{{ data_table|get:"company name" }}</label>
					                                        <input class="w-full border py-2 px-3 text-13 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder:text-gray-600 dark:border-zink-50 dark:placeholder:text-zink-200" type="text" id="company_name"  name="company_name" required>
					                                    </div>

					                                    <div>
					                                        <label for="example-text-input" class="block font-medium text-gray-700 mt-2 text-13 dark:text-zink-200">{{data|get:"Company ID"}}</label>
					                                        <input class="w-full border py-2 px-3 text-13 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder:text-gray-600 dark:border-zink-50 dark:placeholder:text-zink-200" type="text" id="company_id"  name="company_id" required>
					                                    </div>


					                                  <!--   <div>
					                                        <label for="example-text-input" class="block font-medium text-gray-700 mt-2 text-13 dark:text-zink-200">Employee ID</label>
					                                        <input class="w-full border py-2 px-3 text-13 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder:text-gray-600 dark:border-zink-50 dark:placeholder:text-zink-200" type="text" id="employee_id"  name="employee_id" required>
					                                    </div> -->


					                                     <div>
					                                        <label for="example-text-input" class="block font-medium text-gray-700 mt-2 text-13 dark:text-zink-200">{{data|get:"Employee Name"}}</label>
					                                        <input class="w-full border py-2 px-3 text-13 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder:text-gray-600 dark:border-zink-50 dark:placeholder:text-zink-200" type="text" id="employee_name"  name="employee_name" required>
					                                    </div>

					                                      <div class="relative">
														    <label for="employee_password" class="block font-medium text-gray-700 mt-2 text-sm dark:text-zink-200">{{login_data|get:"password"}}</label>
														    <div class="flex items-center">
														        <input class="w-full border py-2 px-3 text-sm rounded border-gray-400 placeholder-text-sm focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder-text-gray-600 dark:border-zink-50 dark:placeholder-text-zink-200" type="text"  id="employee_password" name="employee_password" required>
														        <button type="button" class="text-blue-500 transition-all duration-300 ease-linear bg-white border-blue-500 focus:text-white focus:ring focus:ring-blue-500/30 hover:bg-blue-600 hover:border-blue-600 hover:text-white active:bg-blue-600 active:border-blue-600 active:text-white dark:bg-transparent focus:bg-blue-500 focus:border-blue-600 btn" onclick="generatePassword()">
														            <!-- Tailwind CSS icon for a key -->
														            <i class=" block text-[14px]  dripicons-clockwise"></i>
														        </button>
														    </div>
														</div>

					                                    

					                                    

					                                </div>



			                                	</div>


			                                	<div class="col-span-12 lg:col-span-6">
			                                		<div>

					                                    <div>
					                                        <label for="example-text-input" class="block font-medium text-gray-700 mb-2 text-13 dark:text-zink-200">{{ data_table|get:"employ last name" }}</label>
					                                        <input class="w-full border py-1. p-2 h-9 placeholder:text-gray-700 rounded border-gray-400 placeholder:text-sm focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent dark:border-zink-50 dark:placeholder:text-zink-200 dark:text-zink-200" type="text"  id="employee_last_name"  name="employee_last_name" required>
					                                    </div>

					                                    <div>
					                                        <label for="example-text-input" class="block font-medium text-gray-700 mt-2 text-13 dark:text-zink-200">{{data|get:"Employee Email"}}</label>
					                                        <input class="w-full border py-2 px-3 text-13 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder:text-gray-600 dark:border-zink-50 dark:placeholder:text-zink-200" type="email"  id="employee_email"  name="employee_email" required>
					                                    </div>

					                                     <div>
					                                        <label for="example-text-input" class="block font-medium text-gray-700 mt-2 text-13 dark:text-zink-200"> {{data|get:"Phone"}}</label>
					                                        <input class="w-full border py-2 px-3 text-13 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder:text-gray-600 dark:border-zink-50 dark:placeholder:text-zink-200" type="text"  id="employee_phone"  name="employee_phone" required>
					                                    </div>


					                                  

														<input type="hidden" name="user_role"  id="user_role" value="super admin">
														
					                                </div>



			                                	</div>


			                               </div>

			                               <div>
				                                        		<button type="submit" class=" py-2 px-3  mt-5 text-white bg-blue-500 hover:bg-blue-700 focus:ring-2 focus:ring-blue-100 font-medium rounded text-sm w-full sm:w-auto px-5 py-2.5 text-center">{{data|get:"Save Details"}}</button>
				                                    	</div>

		                           		</form>
		                        {% else %}


		                        	<form method="POST" class ="{% url 'super_admin:addSuperAdmin' %}" id="add_user_form_bulk" enctype="multipart/form-data">
	                                					<h6 class="font-semibold text-16 mb-5"> {{data|get:"Add Super Admins with Bulk Upload"}}</h6>

	                                						<div class="flex flex-wrap gap-2 mt-4  mb-4">
                              
                                								<a href="/static/super_admin/assets/files_format/superadmins_bulk_file_template.csv" download="superadmins_bulk_file_template.csv" class="text-white transition-all duration-300 ease-linear bg-dark-500 border-dark-500 hover:bg-dark-600 hover:border-dark-600 hover:text-white active:bg-dark-600 active:border-dark-600 active:text-white focus:bg-dark-600 focus:border-dark-600 focus:text-white focus:ring focus:ring-dark-500/30 btn min-w-[20px]" title='{{product_data|get:"Download Bulk File Template"}}'> <i class="fa fa-download"></i></a>

                               
                            								</div>
	                                					<div id="info_selector_bulk">
	                                					</div>

	                                					  <input type="hidden" name="entry_type" id="entry_type" value="{{ entry_type }}">
	                                					{% csrf_token %}
						                                <div class="grid grid-cols-12 gap-5 mt-2">
						                                	<div class="col-span-12">
						                                			<div>
						                                			
										                                   <label for="example-text-input" class="block font-medium text-gray-700 mb-2 text-13 dark:text-zink-200"> {{data|get:"Upload Bulk File"}}</label>
										                                   <input class="w-full border py-2 px-3 text-13 rounded border-gray-400 placeholder:text-13 focus:border focus:border-gray-400 focus:ring-0 focus:outline-none text-gray-700 dark:bg-transparent placeholder:text-gray-600 dark:border-zink-50 dark:placeholder:text-zink-200" type="file" id="bulk_upload_file"  name="bulk_upload_file" required>

										                                   <label class="ltr:ml-2 rtl:mr-2 text-13 text-gray-600 font-medium dark:text-zink-200" for="formrow-customCheck">

										                                   	{{ product_data|get:"Note: Only CSV files are allowed with header"}}

										                                    (company_name,company_id,employee_name,account_password,employee_last_name,employee_email_address,employee_phone)</label>
										                            </div>


										                            <div>
							                                        	<button type="submit" class=" py-2 px-3  mt-5 text-white bg-blue-500 hover:bg-blue-700 focus:ring-2 focus:ring-blue-100 font-medium rounded text-sm w-full sm:w-auto px-5 py-2.5 text-center"><i class="fa fa-save"></i></button>
							                                    	</div>

								                               



						                                	</div>


						                                	
						                                	<input type="hidden" name="user_role"  id="user_role" value="super admin">


						                               </div>

			                               				
	                           						</form>

	                           				{% endif %}

                            </div>
                        </div>
                        
                  
                </div>

            </div>
            <!-- container-fluid -->
        </div>
        <!-- End Page-content -->

        {% include 'super_admin/partials/footer.html' %}
    </div>
</div>
<!-- end main content -->

{% include 'super_admin/partials/customizer.html' %}
{% include 'super_admin/partials/vendor-scripts.html' %}
<!-- App js -->
<script src="/static/super_admin/assets/libs/sweetalert2/sweetalert2.min.js"></script>
<script src="{% static 'super_admin/assets/js/app.js' %}"></script>

<script>
	var mapping = {
	csv_error_msg: '{{ product_data|get:"Only CSV file is allowed" }}',
};
    // JavaScript code for password generation
    function generatePassword() {
        // Your password generation logic here
        // For simplicity, let's generate a random 8-character password
        const password = Math.random().toString(36).slice(-14);

        // Update the input field with the generated password
        document.getElementById('employee_password').value = password;
    }
    let entry_type = $("#entry_type").val();
    if (entry_type == "single")
    	generatePassword();

    $("#add_user_form").submit(function(e){
            e.preventDefault();
            let form_data = $(this).serialize();
            $.ajax({
                method:'POST',
                url:$(this).attr('class'),
                dataType:'JSON',
                data:form_data,
                success:function(data){
                    console.log(data);
                    if (data.success == 1){
                    	$("#add_user_form")[0].reset();
                        $("#info_selector").empty().append(`<div class="px-5 py-3 text-green-800 bg-green-100 border border-green-200 rounded-md dark:text-green-200 dark:bg-green-500/20 dark:border-green-500/20">${data.msg}</div>`);
                    }else{
                        $("#info_selector").empty().append(`<div class="px-5 py-3 text-red-800 bg-red-100 border border-red-200 rounded-md dark:border-red-500/20 dark:text-red-200 dark:bg-red-500/20" role="alert" id="error">${data.msg}</div>`);
                    }
                    
                    setTimeout(() => {
                        $("#info_selector").empty();
                    }, 10000);
                },
            });
    });

    $("#add_user_form_bulk").submit(function(e){
            e.preventDefault();
            var formData = new FormData(this);
            // console.log(form_data);
            $.ajax({
            	method:'POST',
               	url: $("#add_user_form_bulk").attr('class'),
	            dataType:'JSON',
	            data:formData,
	            processData: false, // Prevent jQuery from processing data
	            contentType: false, // Prev
                success:function(data){
                    // console.log(data);
                    if (data.success == 1){
                    	$("#add_user_form_bulk")[0].reset();
                        $("#info_selector_bulk").empty().append(`<div class="px-5 py-3 text-green-800 bg-green-100 border border-green-200 rounded-md dark:text-green-200 dark:bg-green-500/20 dark:border-green-500/20">${data.msg}</div>`);

                        let track = data.track;
                        for (let i=0; i < track.length; i++)
                        	$("#info_selector_bulk").append(`<div class="px-5 py-3 text-red-800 bg-red-100 border border-red-200 rounded-md dark:text-red-200 dark:bg-red-500/20 dark:border-red-500/20">${track[i].msg}</div>`);

                        
                    }else{
                        $("#info_selector_bulk").empty().append(`<div class="px-5 py-3 text-red-800 bg-red-100 border border-red-200 rounded-md dark:border-red-500/20 dark:text-red-200 dark:bg-red-500/20" role="alert" id="error">${data.msg}</div>`);
                    }
                    
                    setTimeout(() => {
                        $("#info_selector_bulk").empty();
                    }, 10000);
                },
            });



    });


    $(document).on('change','#bulk_upload_file',function(event){

                const selectedFile = event.target.files[0];
                const fileName = selectedFile.name.toLowerCase();
                if (fileName.endsWith('.csv')) {
                    console.log('Valid CSV file selected:', fileName);
                    // Handle the file or perform further actions
                } else {
                    Swal.fire({
                            position: 'center',
                            icon: 'error',
                            title: mapping.csv_error_msg,
                            showConfirmButton: false,
                            timer: 3000
                    });
                    // Clear the file input
                    $('#bulk_upload_file').val('');
      			}
        
    });
</script>
</body>
</html>